<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Empatica for Developers by empatica</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">
			<h1>Note: at this time, Empatica TCP Server is not fully supported anymore.</h1>

			<header>
				<h1>Empatica TCP Server</h1>
			</header>

			<p>This is a reference guide of the communication protocol supported by the Empatica TCP Server. Empatica TCP server allows to receive realtime data from multiple Empatica E3 devices. Each TCP connection is allowed to connect to one Empatica Device at time. To connect to multiple devices, multiple TCP connections are required.
			The server accepts TCP sockets connections. After a succesful connection from a client, the server waits for command messages.</p>

			<p><a href="#data-packet">General message structure</a> is described in the following section while details on client commands and server responses are described in <a href="#commandPacket">commands</a> and <a href="#data-packet">data</a> section.<br>
			To get a glance of the communication protocol, visit the <a href="#protocol-example">protocol example</a> section.</p>


			<a class="paddedLink" id="general-packets"></a><h2>General message structure</h2>
								Messages are ASCII strings terminated with a newline ('\n') character. Some commands have parameters, which are separated by spaces.
								Client requests are in the following format:
			<pre>Client request format<code>
				&lt;COMMAND&gt; &lt;ARGUMENT_LIST&gt;</code>
			Example
			<code>	device_subscribe gsr ON
			</code></pre>

								Messages from server containing <b>responses to commands</b> are in the following format:
			<pre>Server response<code>
				R &lt;COMMAND&gt; &lt;ARGUMENT_LIST&gt;</code>
			Example
			<code>	R device_subscribe acc ON
			</code></pre>


								Messages from server containing <b>data from device</b> are in the following format:
			<pre>Stream Data Format<code>
				&lt;STREAM_TYPE&gt; &lt;TIMESTAMP&gt; &lt;DATA&gt;</code>
			Example
			<code>	G 123345627891.123 3.129
			</code></pre>

							<a class="paddedLink" id="commandPacket"></a><h2>Commands and Responses Details</h2>
							
							<h3>Server Status</h3>
							<p>The client requires the current status of the server. The server status is <b>OK</b> when the server is fully functional and ready to connect to Empatica E4 devices.
								The server status is <b>ERR</b> if something is wrong (often, problems are related to Bluetooth low energy adapter).
							</p>

			<pre>Client Request<code>
				server_status
			</code></pre>

			<pre>Server Response<code>
				R server_status OK
				R server_status ERR &lt;reason&gt;
			</code>Example:<code>
				R server_status ERR Bluetooth low energy not available on server</code>
			</pre>

							<h3>List of available devices</h3>
							<p>The client requires the list of Empatica E4 devices in range and available to connect. The server responds with the number of available devices and
								a list of devices info.</p>


			<pre>Client Request<code>
				device_list
			</code></pre>

			<pre>Server Response<code>
				R device_list &lt;NUMBER_OF_DEVICES&gt; | &lt;DEVICE_INFO_1&gt; | &lt;DEVICE_INFO_2&gt;
			</code>Example<code>
				R device_list 2 | 9ff167 Empatica_E3 available | 740163 Empatica_E3 available
			</code></pre>


			<p>The format of the device info is the following:</p>

			<pre>DEVICE_INFO format<code>
				&lt;DEVICE_ID&gt; &lt;DEVICE_NAME&gt; &lt;AVAILABILITY&gt;
			</code>Example<code>
				9ff167 Empatica_E3 available
			</code></pre>

			<em>DEVICE_ID</em>
			<p>The device id is unique for every device. It is used by the client during a connect request.</p>

			<em>DEVICE_NAME</em>
			<p>The device name is used</p>

			<em>AVAILABILITY</em>
			<p>Availability parameter is always <em>available</em>. Other values are reserved for future implementation.</p>


			<h3>Connect to a Device</h3>
							<p>The client sends a connection request to a specific device. Each TCP connection is allowed to connect to one Empatica Device at time. To connect to multiple devices, multiple TCP connections are required.</p>


			<pre>Client Request<code>
				device_connect &lt;DEVICE_ID&gt;
			</code>Example:<code>
				device_connect 9ff167
			</code></pre>

			<em>DEVICE_ID</em>
			<p>The device id is returned from the server after a device_list command.</p>

			<pre>Server Response<code>
				R device_connect OK
				R device_connect ERR &lt;reason&gt;
			</code>Example:<code>
				R device_connect ERR The device requested for connection is not available.</code>
			</pre>

			<h3>Disconnect from a Device</h3>
							<p>The client sends a device disconnection request. It will be disconnected from the currently connected device.</p>

			<pre>Client Request<code>
				device_disconnect
			</code></pre>

			<pre>Server Response<code>
				R device_disconnect OK
				R device_disconnect ERR &lt;reason&gt;
			</code>Example:<code>
				R device_disconnect ERR No connected device.</code>
			</pre>


			<p>In case of device disconnection (e.g., the user switch off the device, or the battery runs out) the server sends the following packet</p>
			<pre>Device Disconnection<code>
				X device_disconnect
			</code></pre>

			<h3>Subscribe to Receive Data</h3>
							<p>To start receiving data from a given stream, the client sends a data subscription request specifying the desired stream.</p>


			<pre>Client Request<code>
				device_subscribe &lt;STREAM&gt; ON
			</code>Example:<code>
				device_subscribe gsr ON
			</code></pre>

			<pre>Server Response<code>
				R device_subscribe &lt;STREAM&gt; ON
				R device_subscribe &lt;STREAM&gt; ERR &lt;REASON&gt;
			</code>Example:<code>
				R device_subscribe gsr OK</code>
			</pre>
			<em>STREAM</em>
			<p>The streams available are the following:</p>
			<ul>
				<li>acc - 3-axis acceleration</li>
				<li>bvp - Blood Volume Pulse</li>
				<li>gsr - Galvanic Skin Response</li>
				<li>ibi - Interbeat Interval</li>
				<li>tmp - Skin Temperature</li>
				<li>bat - Device Battery</li>
			</ul>

			<h3>Unsubscribe from Receive Data</h3>
							<p>To stop receiving data from a given stream, the client sends a data unsubscription request specifying the desired stream.</p>

			<pre>Client Request<code>
				device_subscribe &lt;STREAM&gt; OFF
			</code>Example:<code>
				device_subscribe gsr OFF
			</code></pre>

			<pre>Server Response<code>
				R device_subscribe &lt;STREAM&gt; OFF
				R device_subscribe &lt;STREAM&gt; ERR &lt;REASON&gt;
			</code>Example:<code>
				R device_subscribe gsr OFF</code>
			</pre>
			<em>STREAM</em>
			<p>The streams available are the following:</p>
			<ul>
				<li>acc - 3-axis acceleration</li>
				<li>bvp - Blood Volume Pulse</li>
				<li>gsr - Galvanic Skin Response</li>
				<li>ibi - Interbeat Interval</li>
				<li>tmp - Skin Temperature</li>
				<li>bat - Device Battery</li>
			</ul>


			<h3>Suspend data streaming</h3>
							<p>To temporarily suspend the data streaming (without disconnecting or switching off the device), the client sends a pause request</p>

			<pre>Client Request<code>
				pause ON
			</code></pre>

			<pre>Server Response<code>
				R pause ON
				R pause ERR &lt;REASON&gt;
			</code>Example:<code>
				R pause ERR You are not connected to any device</code>
			</pre>


			<h3>Resume data streaming</h3>
							<p>To resume the data streaming, the client sends a resume request</p>

			<pre>Client Request<code>
				pause OFF
			</code></pre>

			<pre>Server Response<code>
				R pause OFF
				R pause ERR &lt;REASON&gt;
			</code>Example:<code>
				R pause ERR You are not connected to any device</code>
			</pre>

			<a class="paddedLink" id="data-packet"></a><h2>Data Streaming Packets</h2>
							<p>After a succesful connection and stream subscription to an Empatica Device, the client starts receiving sensor's data from the server.</p>

			<pre>Stream Data Format<code>
				&lt;STREAM_TYPE&gt; &lt;TIMESTAMP&gt; &lt;DATA&gt;</code>
			Example
			<code>	G 123345627891.123 3.129
			</code></pre>

			<em>STREAM_TYPE</em>
			<p>The streams available are the following:</p>
			<ul>
				<li>A - 3-axis acceleration</li>
				<li>B - Blood Volume Pulse</li>
				<li>G - Galvanic Skin Response</li>
				<li>T - Skin Temperature</li>
				<li>I - Interbeat Interval</li>
				<li>F - Device Battery</li>
			</ul>

			<em>TIMESTAMP</em>
			<p>The timestamp for the sample in seconds defined as time interval between the sample received and the reference date, 1 January 1970, GMT.</p>

			<em>DATA</em>
			<p>Each stream type has different data format as described below:</p>

			<p><em>Acceleration data</em>
			<ul>
				<li>The acceleration value for x axis. The x axes is defined by the vector whose starting point is set to the center of the device and whose direction points towards the USB slot.</li>
				<li>The acceleration value for y axis. The y axes is defined by the vector whose starting point is set to the center of the device and whose direction points towards the shorter strap.</li>
				<li>The acceleration value for z axis. The x axes is defined by the vector whose starting point is set to the center of the device and whose direction points towards the bottom of the device.</li>
			</ul>
			<pre>Acceleration data<code>
				A 123345627891.123 51 -2 -10
			</code></pre>

			<p><em>Blood Volume Pulse data</em><br/>
			&nbsp;&nbsp; The value of the BVP sample. The value is derived from the light absorbance of the arterial blood.   The raw signal is filtered to remove movement artifacts. <br/>
			<pre>Blood Volume Pulse data<code>
				B 123345627891.123 31.128
			</code></pre>

			<p><em>Galvanic Skin Response data</em><br/>
			&nbsp;&nbsp; The value of the GSR sample. The value is expressed in microsiemens.<br/>
			<pre>Galvanic Skin Response data<code>
				G 123345627891.123 3.129
			</code></pre>

			<p><em>Temperature data</em><br/>
			&nbsp;&nbsp; The value of the temperature sample in Celsius degrees. The value is derived from the optical temperature sensor placed on the wrist.<br/>
			<pre>Temperature data<code>
				T 123345627891.123 35.82
			</code></pre>

			<p><em>Interbeat Interval data</em><br/>
			&nbsp;&nbsp; The value of the IBI sample. The value is the distance from the previous detected heartbeat in seconds.<br/>
			<pre>Interbeat Interval data<code>
				I 123345627891.123 0.822
			</code></pre>

			<p><em>Battery level data</em><br/>
			&nbsp;&nbsp; The battery level of the device. Values: [0.0 - 1.0]<br/>
			<pre>Battery level data<code>
				F 123345627891.123 0.2
			</code></pre>



							<a class="paddedLink" id="protocol-example"></a><h2>Protocol Example</h2>
			Here is an example of messages exchange between client and server during a brief acquisition session.

			<pre><code>[OPEN TCP CONNECTION]
			==> server_status
			<== R server_status OK

			==> device_list
			<== R device_list 2 | 9ff167 Empatica_E3 available | 7a3166 Empatica_E3 available

			==> device_connect ffffff
			<== R device_connect ERR the requested device is not available

			==> device_connect 9ff167
			<== R device_connect OK

			==> device_subscribe bvp ON
			<== R device_subscribe bvp OK

			<== B 123345627891.123 3.212
			<== B 123345627891.327 10.423
			<== B 123345627891.472 12.665

			==> device_disconnect
			<== R device_disconnect OK
			[EOF]
			</code></pre>




				<a class="paddedLink" id="protocol-example"></a><h2>Using Empatica TCP Server for OSX</h2>
				NOTE: this part of the documentation is still under development
				<h3>Installation</h3>
					Copy EmpaticaTCPServer.app in your Application folder.
				<h3>Usage</h3>
					When running, a red icon with the Empatica logo is placed in the menu bar. Clicking on such icon, it will pop out a menu for controlling the Empatica TCP server.
					

					<h4>Configuration</h4>
					Before starting the server, you should visit the preferences panel by clicking on <em>Menu->Configuration...</em>
					<br>
					The Settings panel allows to set
					<ul>
						<li>the listening IP address of the server</li>
						<li>the listening TCP port server</li> 
						<li>your Empatica API Key</li>
					</ul>

					<h4>Start/Stop the server</h4>
					To start the server click on <em>Menu->Start TCP Server</em><br />

					When devices and clients are connected, some information about the connection status is shown for debug purpose.

				<h3>Empatica TCP Client Demo App</h3>
					The demo TCP client app implements a basic client for demo purpose. It allows to quickly evaluate the Empatica TCP server and its code can be used as starting point for the development of custom applications.
		</section>
        <footer>
          <p>Having trouble with Empatica developer's software? <a href="mailto:support@empatica.com">Contact support</a> and we’ll help you sort it out.</p>
        </footer>
      </div>
    </div>
  </body>
</html>